def for_day(pickup_day, order_items)
  if order_items.empty?
    return
  end

  counts = Hash.new(0)
  order_items.each { |oi| counts[oi.item.name] += oi.quantity }

  div do
    em("#{pickup_day.day_str}: ")

    item_names = counts.keys.natural_sort
    item_names.each_with_index do |name, i|
      span do
        if (count = counts[name]) > 1
          strong "#{count}x "
        end

        is_last = i + 1 == item_names.size
        span "#{name}#{is_last ? "" : ","}"
      end
    end
  end
end

pay_it_forward, rest = order_items.partition { |oi| oi.item.pay_it_forward? }

pickup_days.each do |pickup_day|
  rest.filter {|oi| oi.pickup_day == pickup_day}
  for_day(pickup_day, order_items)  
end

if pay_it_forward.any?
  num = pay_it_forward.map(&:quantity).sum
  div do
    em do
      if num > 1
        strong "#{num}x "
      end

      span pay_it_forward.first.item.name
    end
  end
end
